<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grammar-Based Pseudo-Random Key Generator</title>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 40px;
      background: #eaf1f8;
      color: #1a1a1a;
    }

    h2, h3 {
      color: #004aad;
    }

    .box {
      background: white;
      padding: 25px;
      margin-bottom: 25px;
      border-radius: 12px;
      border-left: 6px solid #004aad;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
    }

    button {
      padding: 12px 20px;
      background: #004aad;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #003680;
    }

    input, textarea, select {
      padding: 10px;
      width: 100%;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #aaa;
    }

    /* One-time pulse animation */
    @keyframes pulse-once {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    .animated-key {
      font-weight: bold;
      font-size: 18px;
      color: #004aad;
    }

    /* Diagram styling */
    .diagram-flow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
      padding: 20px;
      border-radius: 12px;
      background: #f8faff;
      box-shadow: 0 0 8px rgba(0,0,0,0.15);
    }

    .node {
      background: white;
      padding: 15px;
      width: 180px;
      text-align: center;
      border-radius: 10px;
      box-shadow: 0px 0px 6px rgba(0,0,0,0.15);
    }

    .node h4 {
      margin-bottom: 8px;
      font-size: 16px;
      color: #124559;
    }

    .node p {
      font-size: 12px;
      line-height: 1.3;
    }

    .arrow {
      font-size: 22px;
      font-weight: bold;
      color: #124559;
    }
  </style>
</head>

<body>

  <!-- Title -->
  <div class="box">
    <h2>Grammar-Based Pseudo-Random Key Generator</h2>
    <p><b>By:</b> Raahima Aamir and Muhammad Talha</p>
    <p>This project demonstrates how formal grammars can be used to generate structured random keys and how such keys can support lightweight encryption.</p>
  </div>

  <!-- Diagram Section -->
  <div class="box">
    <h3>Project Diagram</h3>

    <div class="diagram-flow">
      
      <div class="node">
        <h4>Context-Free Grammar</h4>
        <p>S → SEG SEG SEG<br>SEG → UP + LOW + DIG + SYM</p>
      </div>

      <div class="arrow">→</div>

      <div class="node">
        <h4>Key Generator</h4>
        <p>Builds 3 segments of mixed character classes</p>
      </div>

      <div class="arrow">→</div>

      <div class="node">
        <h4>XOR Encryption</h4>
        <p>Key ⊕ Message → Ciphertext</p>
      </div>

      <div class="arrow">→</div>

      <div class="node">
        <h4>XOR Decryption</h4>
        <p>Key ⊕ Ciphertext → Original Text</p>
      </div>

    </div>

    <p style="font-size: 14px;">
      <b>Explanation:</b>  
      The grammar produces structured random segments, which form the encryption key.
      This key is then used in a lightweight XOR encryption cycle.
    </p>
  </div>


  <!-- Key Generator -->
  <div class="box">
    <h3>Generate Grammar-Based Key</h3>
    <button onclick="generateKey()">Generate New Key</button>
    <p id="keyOutput" class="animated-key"></p>

    <p style="font-size: 14px;">
      <b>Explanation:</b>  
      The generator forms a structured key using uppercase, lowercase, digits, and symbols in controlled positions, based on a formal grammar.
    </p>
  </div>


  <!-- Grammar Mode Section -->
  <div class="box">
    <h3>Grammar Mode (A / B / C)</h3>

    <label for="grammarSelect" style="font-size: 15px; font-weight: 600;">
      Choose Grammar:
    </label>
    <select id="grammarSelect">
      <option value="A">Grammar A – Fixed Pattern</option>
      <option value="B">Grammar B – Variable Pattern</option>
      <option value="C">Grammar C – Stochastic Pattern</option>
    </select>

    <button onclick="generateByGrammar()" style="margin-top: 15px;">
      Generate Key by Grammar
    </button>

    <div id="grammarKeyOutput" style="margin-top: 15px; font-weight: bold;"></div>
    <p id="grammarExplanation" style="margin-top: 10px; font-size: 14px; opacity: 0; transition: 0.3s;"></p>
  </div>


  <!-- Encryption -->
  <div class="box">
    <h3>Encrypt Text</h3>
    <textarea id="plain" placeholder="Enter text to encrypt"></textarea>
    <button onclick="encryptText()">Encrypt</button>
    <p id="cipherOutput" style="margin-top: 10px; font-weight: bold;"></p>

    <p style="font-size: 14px;">
      <b>Explanation:</b>  
      The plaintext is XORed with the key to produce Base64 ciphertext.
    </p>
  </div>


  <!-- Decryption -->
  <div class="box">
    <h3>Decrypt Text</h3>
    <textarea id="cipher" placeholder="Enter ciphertext (Base64)"></textarea>
    <button onclick="decryptText()">Decrypt</button>
    <p id="plainOutput" style="margin-top: 10px; font-weight: bold;"></p>

    <p style="font-size: 14px;">
      <b>Explanation:</b>  
      XORing the ciphertext with the same key restores the original plaintext.
    </p>
  </div>


  <!-- Grammar Comparison Section -->
  <div class="box">
    <h3>Grammar Comparison</h3>

    <p style="font-size: 14px;">
      Three grammars were evaluated to study how structure affects randomness and computation speed.
    </p>

    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
      <tr style="background: #f2f2f2;">
        <th style="padding: 8px; border: 1px solid #ccc;">Grammar</th>
        <th style="padding: 8px; border: 1px solid #ccc;">Avg. Length</th>
        <th style="padding: 8px; border: 1px solid #ccc;">Avg. Entropy</th>
        <th style="padding: 8px; border: 1px solid #ccc;">Avg. Time (ms)</th>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #ccc;">A (Fixed)</td>
        <td style="padding: 8px; border: 1px solid #ccc;">12.00</td>
        <td style="padding: 8px; border: 1px solid #ccc;">3.48</td>
        <td style="padding: 8px; border: 1px solid #ccc;">41.73</td>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #ccc;">B (Variable)</td>
        <td style="padding: 8px; border: 1px solid #ccc;">11.74</td>
        <td style="padding: 8px; border: 1px solid #ccc;">3.34</td>
        <td style="padding: 8px; border: 1px solid #ccc;">39.22</td>
      </tr>
      <tr>
        <td style="padding: 8px; border: 1px solid #ccc;">C (Stochastic)</td>
        <td style="padding: 8px; border: 1px solid #ccc;">9.73</td>
        <td style="padding: 8px; border: 1px solid #ccc;">3.17</td>
        <td style="padding: 8px; border: 1px solid #ccc;">30.83</td>
      </tr>
    </table>

    <p style="margin-top: 10px; font-size: 14px;">
      <b>Conclusion:</b>  
      Grammar A provides the strongest structure and highest entropy.
      Grammar C is fastest but has lowest structure.  
      Grammar B balances both.
    </p>
  </div>


  <!-- Links -->
  <div class="box">
    <h3>Links</h3>
    <p><a href="https://github.com/raahimaaamir/context-free-grammer-encryption.git" target="_blank">GitHub Repository</a></p>
    <p><a href="https://www.youtube.com/watch?v=nVOC6ygditA" target="_blank">YouTube Demo</a></p>
  </div>


<script>
  // Character classes
  const upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const lower = "abcdefghijklmnopqrstuvwxyz";
  const digits = "0123456789";
  const symbols = "!@#$%&*?+-_=<>/";

  // Default grammar: fixed SEG
  function generateSegment() {
    let seg = "";
    seg += upper[Math.floor(Math.random() * upper.length)];
    seg += lower[Math.floor(Math.random() * lower.length)];
    seg += digits[Math.floor(Math.random() * digits.length)];
    seg += symbols[Math.floor(Math.random() * symbols.length)];
    return seg;
  }

  function generateKey() {
    let key = generateSegment() + generateSegment() + generateSegment();
    const keyElem = document.getElementById("keyOutput");

    keyElem.innerText = "Generated Key: " + key;

    keyElem.style.animation = "none";
    void keyElem.offsetWidth;
    keyElem.style.animation = "pulse-once 0.8s ease-out";

    window.currentKey = key;
  }

  // Grammar Mode Generator
  function generateByGrammar() {
    const mode = document.getElementById("grammarSelect").value;
    let key = "";
    let exp = "";

    if (mode === "A") {
      for (let i = 0; i < 3; i++) {
        key += upper[Math.floor(Math.random() * upper.length)];
        key += lower[Math.floor(Math.random() * lower.length)];
        key += digits[Math.floor(Math.random() * digits.length)];
        key += symbols[Math.floor(Math.random() * symbols.length)];
      }
      exp = "Grammar A enforces a strict 4-symbol structure, maximizing diversity and entropy.";
    }

    if (mode === "B") {
      for (let i = 0; i < 10; i++) {
        const c = Math.floor(Math.random() * 4);
        if (c === 0) key += upper[Math.floor(Math.random() * upper.length)];
        if (c === 1) key += lower[Math.floor(Math.random() * lower.length)];
        if (c === 2) key += digits[Math.floor(Math.random() * digits.length)];
        if (c === 3) key += symbols[Math.floor(Math.random() * symbols.length)];
      }
      exp = "Grammar B allows variable selection from all character classes, producing balanced randomness.";
    }

    if (mode === "C") {
      const all = upper + lower + digits + symbols;
      for (let i = 0; i < 8; i++) {
        key += all[Math.floor(Math.random() * all.length)];
      }
      exp = "Grammar C is fully stochastic. It is fast and random but less structurally controlled.";
    }

    document.getElementById("grammarKeyOutput").innerText = key;

    const box = document.getElementById("grammarExplanation");
    box.textContent = exp;
    box.style.opacity = 1;

    window.currentKey = key;
  }

  // XOR helper
  function xorEncrypt(text, key) {
    let out = "";
    for (let i = 0; i < text.length; i++) {
      out += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
    }
    return out;
  }

  function encryptText() {
    const text = document.getElementById("plain").value;
    const key = window.currentKey || "DEFAULTKEY";
    const encrypted = xorEncrypt(text, key);
    document.getElementById("cipherOutput").innerText =
      "Ciphertext (Base64): " + btoa(encrypted);
  }

  function decryptText() {
    try {
      const text = atob(document.getElementById("cipher").value);
      const key = window.currentKey || "DEFAULTKEY";
      const decrypted = xorEncrypt(text, key);
      document.getElementById("plainOutput").innerText = "Decrypted Text: " + decrypted;
    } catch {
      document.getElementById("plainOutput").innerText = "Invalid ciphertext format.";
    }
  }
</script>

</body>
</html>
